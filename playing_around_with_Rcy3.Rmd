---
title: "playing_around_with_RCy3_functions"
author: "Julia Gustavsen"
date: "May 24, 2016"
output: 
    html_document:
      keep_md: true
---

```{r}
library(RCy3)
```

```{r}
CytoscapeConnection() # checks for the connection
CytoscapeWindow("test", overwriteWindow = TRUE) # creates empty window in Cytoscape
existing.CytoscapeWindow("new") # throws an error if it does not exist yet
existing.CytoscapeWindow("test") # The constructor for the CytoscapeWindowClass, used when Cytoscape already contains 
## and displays a network. COuld be useful. 

#check.cytoscape.plugin.version() ## doesn't work with loading the regular library. or in dev. Seems to work a bit more if loaded separately

```

So how do I get the api version and see what is available?

```{r}
library(igraph)
library(RJSONIO)
library(httr)

```


```{r}
resetCytoscapeSession <-
  function(port.number=1234)
  {
    base.url = paste("http://localhost:", toString(port.number), "/v1", sep="")
    reset.url <- paste(base.url,"session",sep="/")
    if (requireNamespace("httr",quietly=TRUE)) {res<-httr::DELETE(reset.url)}
    else {stop("httr package must be installed to use this function")}
  }
```




```{r}
port.number = 1234

resetCytoscapeSession(port.number) # just to make sure you are using a clean Cytoscape
## removes all previous networks that were loaded in that session.

base.url = paste("http://localhost:",
                 toString(port.number),
                 "/v1", sep="")
base.url

version.url = paste(base.url,
                    "version",
                    sep="/")

cytoscape.version = GET(version.url)

cy.version = fromJSON(rawToChar(cytoscape.version$content))
cy.version

basic_info = GET(base.url)

basic_info = fromJSON(rawToChar(basic_info$content))
basic_info


```

The idea is how do I find more info on the api and what it shows? For example...how do I access enrichment map.

```{r}
  network.url = paste(base.url, "networks", sep="/")
## lists networks 

  # res <- POST(url=network.url, body=cygraph, encode="json")
  # 
  # # Extract SUID of the new network
  # network.suid = unname(fromJSON(rawToChar(res$content)))
  # network.suid
  # 
  # 
  # #http://localhost:1234/v1/apply/styles
  # ## what else apply?
  # #http://localhost:1234/v1/apply/layouts
  # ## and then give to specific network
  # #and can send the parameters via jsonlite::
  # 
  # # Apply style
  # apply.style.url = paste(base.url, "apply/styles", style.name , toString(network.suid), sep="/")
  # GET(apply.style.url)
  # 
  # # Apply force-directed layout --need this first
  #   # Tweak Layout parameters
  #   layout.params = list(
  #    name="unweighted",
  #    value=TRUE
  #    )
  # 
  #   layout.params.url = paste(base.url, "apply/layouts/kamada-kawai/parameters", sep="/")
  #   PUT(layout.params.url, body=toJSON(list(layout.params)), encode = "json")
  # 
  #   apply.layout.url = paste(base.url, "apply/layouts/kamada-kawai", toString(network.suid), sep="/")
```


How do I find out what is available at the for the REST APIs?

from manual - not sure I understand the difference
" Cytoscape offers two flavors of REST-style control: REST Commands and cyREST. REST Commands uses a REST interface to issue script commands. cyREST uses a REST interface to access the Cytoscape data model as a document via a formal API"

Trying with clustermaker
```{r}
  ## what else apply?
#  http://localhost:1234/v1/apply/layouts
  ## and then give to specific network
  #and can send the parameters via jsonlite::
  

##cluster maker stuff idea?
#   apply.clustering.url = paste(base.url,"apply/cluster",cluster.command, toString(network.suid), sep="/")
# GET(apply.clustering.url)
# 
# try cluster network?
  
  # Apply force-directed layout --need this first
    # Tweak Layout parameters
    # layout.params = list(
    #  name="unweighted",
    #  value=TRUE
    #  )
    # 
    # layout.params.url = paste(base.url, "apply/layouts/kamada-kawai/parameters", sep="/")
    # PUT(layout.params.url, body=toJSON(list(layout.params)), encode = "json")
    # 
    # apply.layout.url = paste(base.url, "apply/layouts/kamada-kawai", toString(network.suid), sep="/")

```


can I use this to query other types of things? 


```{r}
## so get layoutNames looks like this.


setMethod('getLayoutNames', 'CytoscapeConnectionClass', 
	function(obj) {
request.uri <- paste(obj@uri, pluginVersion(obj), "apply/layouts", sep="/")
        request.res <- GET(url=request.uri)
        
        available.layouts <- unname(fromJSON(rawToChar(request.res$content)))
                return(available.layouts)
})
```

so to look at the current parameters of one type of attribute: 

http://localhost:1234/v1/apply/layouts/attribute-circle/parameters



so we see they are pasting url/v1/apply/layouts/ to find available layouts

```{r}
cy <- CytoscapeConnection ()
getLayoutNames (cy)
```


Ok maybe we are getting somewhere. 

```{r}
# paste(obj@uri, version, "networks", net.SUID, "tables/defaultnode/rows", as.character(node.SUIDs[i]), attribute.name, sep="/")
```

http://localhost:1234/v1/networks - gives list of networks

http://localhost:1234/v1/networks/13633 - gives json formatted view of network
http://localhost:1234/v1/networks/13633/tables - shows all networks?
http://localhost:1234/v1/networks/13633/tables/defaultnode
http://localhost:1234/v1/networks/13633/tables/defaultnode/rows

http://localhost:1234/v1/networks/13633/tables/defaultedge
http://localhost:1234/v1/networks/13633/tables/defaultedge/rows


what about how to list what can be applied???

http://localhost:1234/v1/apply/enrichmentmap/

```{r}
#paste(obj@uri, version, "apply/styles", "default", net.SUID, sep = "/")
## fit.content
#resource.uri <- paste(obj@uri, pluginVersion(obj), "apply/fit", net.SUID, sep="/")
## get style names
#paste(obj@uri, pluginVersion(obj), "apply/styles", sep="/")
```

http://localhost:1234/v1/apply/styles

found this page which is helpful for the api:

http://idekerlab.github.io/cyREST/#1637304040
http://localhost:1234/v1/networks.names/ - returns json list
http://localhost:1234/v1/tables/count/


Ok hhallelya!! http://localhost:1234/v1/commands !!!

```{r}
# setMethod('getCommandNames', 'CytoscapeConnectionClass', 
# 	
#           function(obj) {
# request.uri <- paste(obj@uri, pluginVersion(obj), "commands", sep="/")
#         request.res <- GET(url=request.uri)
#         
#         available.commands <- unname(fromJSON(rawToChar(request.res$content)))
#                 return(available.commands)
# })

## playing around

commands.uri <- paste(base.url, "commands", sep="/")
request.res <- GET(url=commands.uri)
request.res

commands_enrichment_map.uri <- paste(base.url, "commands/enrichmentmap", sep="/")
request.res <- GET(url=commands_enrichment_map.uri )
request.res
```

